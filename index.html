// Mobile menu
const burger = document.getElementById("burger");
const mobileMenu = document.getElementById("mobileMenu");

if (burger && mobileMenu) {
  burger.addEventListener("click", () => {
    mobileMenu.classList.toggle("open");
    const isOpen = mobileMenu.classList.contains("open");
    mobileMenu.setAttribute("aria-hidden", String(!isOpen));
  });

  mobileMenu.querySelectorAll("a").forEach(a => {
    a.addEventListener("click", () => {
      mobileMenu.classList.remove("open");
      mobileMenu.setAttribute("aria-hidden", "true");
    });
  });
}

// Reveal on scroll
const revealEls = document.querySelectorAll(".reveal");
const io = new IntersectionObserver((entries) => {
  entries.forEach((e) => {
    if (e.isIntersecting) e.target.classList.add("in");
  });
}, { threshold: 0.12 });

revealEls.forEach(el => io.observe(el));

// Animated counters
function animateCount(el, end) {
  const duration = 950;
  const t0 = performance.now();

  function tick(t) {
    const p = Math.min((t - t0) / duration, 1);
    const val = Math.floor(end * (1 - Math.pow(1 - p, 3)));
    el.textContent = val;
    if (p < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

const metricNums = document.querySelectorAll(".metric-num[data-count]");
let counted = false;

const metricIO = new IntersectionObserver((entries) => {
  entries.forEach((e) => {
    if (!counted && e.isIntersecting) {
      counted = true;
      metricNums.forEach(n => animateCount(n, Number(n.dataset.count || "0")));
    }
  });
}, { threshold: 0.25 });

metricNums.forEach(n => metricIO.observe(n));

// Footer year
const year = document.getElementById("year");
if (year) year.textContent = new Date().getFullYear();
